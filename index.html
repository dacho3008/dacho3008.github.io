  <!DOCTYPE html>
<html lang="auto">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REGIO CONNECT - Your Local Everything, Everywhere!</title>
    <meta name="description" content="Find everything local, anywhere in the world. Emergency services, businesses, jobs - all in your language!">
    
    <!-- SEO Meta Tags -->
    <meta property="og:title" content="REGIO CONNECT - Local Services Platform">
    <meta property="og:description" content="Find local businesses, emergency services, and events in your area">
    <meta property="og:image" content="https://dacho3008.github.io/dacho3008.githup.io/logo.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=AZDxjDScFpQtjWTOUtWKbyN_bDt4OgqaF4eYXlewfBP4-8aqX3PiV8e1GWU6liB2CUXlkA59kJXE7M6R&currency=EUR"></script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-REGIOCONNECT"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-REGIOCONNECT');
    </script>
    
    <style>
        /* Professional Design System */
        :root {
            --primary: #1e3a8a;
            --secondary: #fbbf24;
            --success: #10b981;
            --danger: #ef4444;
            --neutral: #6b7280;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, #2563eb 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- EMERGENCY BUTTON - ALWAYS VISIBLE -->
    <div class="fixed top-20 right-4 z-50">
        <button onclick="showEmergency()" class="bg-red-600 text-white px-6 py-4 rounded-full text-xl font-bold animate-pulse shadow-2xl hover:scale-110 transition">
            <span class="emergency-text">üö® EMERGENCY</span>
        </button>
    </div>

    <!-- LANGUAGE SELECTOR -->
    <div class="fixed top-4 right-4 z-50">
        <select id="language" onchange="changeLanguage()" class="px-4 py-2 rounded bg-white shadow-lg">
            <option value="auto">üåê Auto-Detect</option>
            <option value="de">üá©üá™ Deutsch</option>
            <option value="en">üá¨üáß English</option>
            <option value="es">üá™üá∏ Espa√±ol</option>
            <option value="fr">üá´üá∑ Fran√ßais</option>
            <option value="tr">üáπüá∑ T√ºrk√ße</option>
            <option value="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
        </select>
    </div>

    <!-- LOCATION PERMISSION MODAL -->
    <div id="location-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white p-8 rounded-lg max-w-md">
            <h3 class="text-2xl font-bold mb-4">üìç Standort-Berechtigung</h3>
            <p class="mb-4">REGIO CONNECT m√∂chte Ihren Standort nutzen um:</p>
            <ul class="list-disc ml-6 mb-6">
                <li>Notdienste in Ihrer N√§he anzuzeigen</li>
                <li>Relevante lokale Services zu finden</li>
                <li>Sie im Notfall zu lokalisieren</li>
            </ul>
            <div class="flex space-x-4">
                <button onclick="acceptLocation()" class="btn-primary flex-1">
                    Erlauben
                </button>
                <button onclick="denyLocation()" class="bg-gray-500 text-white px-6 py-3 rounded flex-1">
                    Ablehnen
                </button>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <div class="bg-gradient-to-r from-blue-900 to-blue-600 text-white p-4 sticky top-0 z-40 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">
                üåç REGIO CONNECT <span id="region-display" class="text-yellow-300"></span>
            </h1>
            
            <div class="flex items-center space-x-4">
                <span id="active-users" class="bg-green-500 px-3 py-1 rounded-full text-sm animate-pulse">
                    <span id="user-count-live">247</span> Users Online
                </span>
                <button onclick="showBusinessLogin()" class="btn-primary">
                    Business Login
                </button>
            </div>
        </div>
    </div>

    <!-- EMERGENCY MODAL (FUNCTIONAL) -->
    <div id="emergency-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50">
        <div class="bg-white m-4 md:m-auto md:w-2/3 lg:w-1/2 mt-20 p-6 rounded-lg">
            <h2 class="text-3xl font-bold text-red-600 mb-4">üö® EMERGENCY SERVICES / NOTDIENSTE</h2>
            
            <div class="grid md:grid-cols-2 gap-4">
                <button onclick="callEmergency('112')" class="bg-red-600 text-white p-6 rounded-lg hover:bg-red-700">
                    <div class="text-4xl">üöí</div>
                    <div class="text-xl font-bold">CALL 112</div>
                    <div class="text-sm">Fire / Police / Ambulance</div>
                </button>
                
                <button onclick="sendEmergencyWhatsApp()" class="bg-green-600 text-white p-6 rounded-lg hover:bg-green-700">
                    <div class="text-4xl">üí¨</div>
                    <div class="text-xl font-bold">WhatsApp SOS</div>
                    <div class="text-sm">Send location via WhatsApp</div>
                </button>
                
                <button onclick="findNearestHospital()" class="bg-blue-600 text-white p-6 rounded-lg hover:bg-blue-700">
                    <div class="text-4xl">üè•</div>
                    <div class="text-xl font-bold">Nearest Hospital</div>
                    <div id="hospital-info" class="text-sm">Searching...</div>
                </button>
                
                <button onclick="findNearestPharmacy()" class="bg-purple-600 text-white p-6 rounded-lg hover:bg-purple-700">
                    <div class="text-4xl">üíä</div>
                    <div class="text-xl font-bold">24H Pharmacy</div>
                    <div id="pharmacy-info" class="text-sm">Searching...</div>
                </button>
            </div>
            
            <div class="mt-4 p-4 bg-yellow-100 rounded">
                <p class="font-bold">Your current location:</p>
                <p id="current-location">Detecting...</p>
            </div>
            
            <button onclick="closeEmergency()" class="mt-4 w-full bg-gray-600 text-white py-3 rounded-lg">
                Close / Schlie√üen
            </button>
        </div>
    </div>

    <!-- BUSINESS REGISTRATION MODAL (FUNCTIONAL) -->
    <div id="register-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 overflow-y-auto">
        <div class="bg-white m-4 md:m-auto md:w-2/3 lg:w-1/2 mt-10 p-8 rounded-lg">
            <h2 class="text-3xl font-bold mb-6">üöÄ Become a REGIO Partner!</h2>
            
            <form id="registration-form" onsubmit="submitRegistration(event)">
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-bold mb-2">Business Name *</label>
                        <input type="text" id="reg-name" required class="w-full p-3 border rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">Contact Person *</label>
                        <input type="text" id="reg-contact" required class="w-full p-3 border rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">Email *</label>
                        <input type="email" id="reg-email" required class="w-full p-3 border rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">Phone *</label>
                        <input type="tel" id="reg-phone" required class="w-full p-3 border rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">Business Type *</label>
                        <select id="reg-type" required class="w-full p-3 border rounded">
                            <option value="">Select...</option>
                            <option value="restaurant">Restaurant/Caf√©</option>
                            <option value="handwerker">Handwerker</option>
                            <option value="shop">Einzelhandel</option>
                            <option value="service">Dienstleistung</option>
                            <option value="medical">Arzt/Gesundheit</option>
                            <option value="other">Andere</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">City *</label>
                        <input type="text" id="reg-city" required class="w-full p-3 border rounded" value="Bergheim">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-bold mb-2">Address *</label>
                        <input type="text" id="reg-address" required class="w-full p-3 border rounded">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-bold mb-2">Select Package *</label>
                        <div class="grid md:grid-cols-3 gap-4">
                            <label class="border rounded p-4 cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="package" value="starter" required>
                                <div class="font-bold">Starter</div>
                                <div class="text-2xl">‚Ç¨100/mo</div>
                                <div class="text-sm text-gray-600">Basic listing</div>
                            </label>
                            <label class="border-2 border-yellow-400 rounded p-4 cursor-pointer bg-yellow-50">
                                <input type="radio" name="package" value="professional" checked>
                                <div class="font-bold">Professional</div>
                                <div class="text-2xl">‚Ç¨250/mo</div>
                                <div class="text-sm text-green-600 font-bold">FIRST MONTH FREE!</div>
                            </label>
                            <label class="border rounded p-4 cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="package" value="enterprise">
                                <div class="font-bold">Enterprise</div>
                                <div class="text-2xl">‚Ç¨500/mo</div>
                                <div class="text-sm text-gray-600">All features</div>
                            </label>
                        </div>
                    </div>
                    <div class="md:col-span-2">
                        <label class="flex items-center">
                            <input type="checkbox" required class="mr-2">
                            <span class="text-sm">I accept the <a href="agb.html" target="_blank" class="text-blue-600 underline">Terms & Conditions</a></span>
                        </label>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button type="submit" class="w-full btn-primary text-lg py-4">
                        Register Now
                    </button>
                    <button type="button" onclick="closeRegisterModal()" class="w-full mt-2 bg-gray-500 text-white py-3 rounded">
                        Cancel
                    </button>
                </div>
            </form>
            
            <div id="registration-success" class="hidden">
                <div class="text-center py-8">
                    <div class="text-6xl mb-4">‚úÖ</div>
                    <h3 class="text-2xl font-bold mb-4">Registration Successful!</h3>
                    <p class="mb-4">We will contact you within 24 hours to activate your account.</p>
                    <div id="payment-instructions" class="bg-gray-100 p-4 rounded">
                        <!-- Payment instructions will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- HERO SECTION -->
    <div class="bg-gradient-to-r from-blue-600 to-green-600 text-white py-20 text-center">
        <h2 class="text-5xl font-bold mb-4">
            <span class="hero-title">Everything Local. Everywhere. Instantly.</span>
        </h2>
        <p class="text-2xl mb-8">
            <span class="hero-subtitle">Your city in your pocket - in any language!</span>
        </p>
        
        <!-- FUNCTIONAL SEARCH BAR -->
        <div class="max-w-2xl mx-auto px-4">
            <div class="bg-white rounded-lg shadow-2xl p-2 flex">
                <input type="text" id="global-search" 
                    placeholder="Search: Restaurant, Doctor, Plumber..." 
                    class="flex-1 p-3 text-black text-lg"
                    onkeypress="if(event.key === 'Enter') performSearch()">
                <button onclick="performSearch()" class="bg-green-500 text-white px-6 py-3 rounded font-bold hover:bg-green-600">
                    <i class="fas fa-search"></i> SEARCH
                </button>
            </div>
        </div>
        
        <!-- QUICK ACTION BUTTONS -->
        <div class="flex justify-center space-x-4 mt-8 flex-wrap gap-4">
            <button onclick="findOpenNow()" class="bg-white text-blue-600 px-6 py-3 rounded-lg font-bold hover:scale-105 transition">
                ‚è∞ Open Now
            </button>
            <button onclick="showFoodOptions()" class="bg-white text-green-600 px-6 py-3 rounded-lg font-bold hover:scale-105 transition">
                üçî Food
            </button>
            <button onclick="showEmergencyServices()" class="bg-white text-red-600 px-6 py-3 rounded-lg font-bold hover:scale-105 transition">
                üè• Medical
            </button>
            <button onclick="showTransport()" class="bg-white text-yellow-600 px-6 py-3 rounded-lg font-bold hover:scale-105 transition">
                üöï Transport
            </button>
        </div>
    </div>

    <!-- REAL-TIME SERVICES NEAR YOU -->
    <div class="bg-gray-100 p-8">
        <div class="container mx-auto">
            <h2 class="text-3xl font-bold text-center mb-8">
                üìç Services Near You
            </h2>
            
            <!-- Loading Spinner -->
            <div id="services-loading" class="text-center py-8">
                <div class="loading-spinner mx-auto"></div>
                <p class="mt-4">Loading local services...</p>
            </div>
            
            <!-- Services Grid (populated dynamically) -->
            <div id="services-grid" class="grid md:grid-cols-3 gap-6 hidden">
                <!-- Services will be loaded here -->
            </div>
            
            <!-- No Services Message -->
            <div id="no-services" class="hidden text-center py-8">
                <p class="text-xl">No services found in your area.</p>
                <button onclick="showRegisterModal()" class="btn-primary mt-4">
                    Be the first to register your business!
                </button>
            </div>
        </div>
    </div>

    <!-- CTA SECTION -->
    <div class="bg-gradient-to-r from-yellow-400 to-orange-500 text-black p-12">
        <div class="container mx-auto text-center">
            <h2 class="text-4xl font-bold mb-4">üöÄ Business Owners: Join Now!</h2>
            <p class="text-xl mb-8">First 10 businesses get 1 month FREE Professional package!</p>
            
            <div class="bg-white/90 backdrop-blur p-6 rounded-lg max-w-md mx-auto">
                <div class="text-3xl font-bold text-red-600 animate-pulse mb-4">
                    Only <span id="spots-left">5</span> FREE spots left!
                </div>
                <button onclick="showRegisterModal()" class="btn-primary text-xl py-4 px-8 w-full">
                    CLAIM YOUR FREE MONTH NOW
                </button>
                
                <!-- WhatsApp Quick Contact -->
                <div class="mt-4">
                    <p class="text-sm mb-2">Or contact us directly:</p>
                    <button onclick="contactViaWhatsApp()" class="bg-green-500 text-white px-6 py-3 rounded-lg font-bold w-full hover:bg-green-600">
                        <i class="fab fa-whatsapp"></i> WhatsApp Us Now
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <div class="bg-gray-800 text-white p-8">
        <div class="container mx-auto">
            <div class="grid md:grid-cols-4 gap-8">
                <div>
                    <h3 class="font-bold mb-4">REGIO CONNECT</h3>
                    <p class="text-sm">Making the world local since 2025</p>
                    <div class="mt-4">
                        <p class="text-xs">Platform Status: <span class="text-green-400">Online</span></p>
                        <p class="text-xs">Response Time: <span id="response-time">12ms</span></p>
                    </div>
                </div>
                <div>
                    <h3 class="font-bold mb-4">Quick Links</h3>
                    <ul class="text-sm space-y-1">
                        <li><a href="#" onclick="showRegisterModal()" class="hover:text-yellow-300">Register Business</a></li>
                        <li><a href="#" onclick="showPricing()" class="hover:text-yellow-300">Pricing</a></li>
                        <li><a href="#" onclick="showContact()" class="hover:text-yellow-300">Contact</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-4">Support</h3>
                    <ul class="text-sm space-y-1">
                        <li><a href="#" onclick="openSupport()" class="hover:text-yellow-300">Help Center</a></li>
                        <li><a href="#" onclick="openFAQ()" class="hover:text-yellow-300">FAQ</a></li>
                        <li><a href="tel:+4916312345678" class="hover:text-yellow-300">Call Support</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-4">Legal</h3>
                    <ul class="text-sm space-y-1">
                        <li><a href="impressum.html" class="hover:text-yellow-300">Impressum</a></li>
                        <li><a href="datenschutz.html" class="hover:text-yellow-300">Privacy Policy</a></li>
                        <li><a href="agb.html" class="hover:text-yellow-300">Terms & Conditions</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-gray-700 mt-8 pt-8 text-center">
                <p>&copy; 2025 REGIO CONNECT - All rights reserved</p>
            </div>
        </div>
    </div>

    <!-- Cookie Consent (FUNCTIONAL) -->
    <div id="cookieBanner" class="fixed bottom-0 left-0 right-0 bg-gray-900 text-white p-4 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <p>We use cookies to improve your experience and provide location-based services.</p>
            <div>
                <button onclick="acceptCookies()" class="bg-green-500 px-4 py-2 rounded mr-2 hover:bg-green-600">
                    Accept
                </button>
                <button onclick="rejectCookies()" class="bg-red-500 px-4 py-2 rounded hover:bg-red-600">
                    Reject
                </button>
            </div>
        </div>
    </div>

    <!-- Live Chat Widget -->
    <!--Start of Tawk.to Script-->
    <script type="text/javascript">
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
        var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
        s1.async=true;
        s1.src='https://embed.tawk.to/5f3e3c3c4c7ec5569748fc4b/default';
        s1.charset='UTF-8';
        s1.setAttribute('crossorigin','*');
        s0.parentNode.insertBefore(s1,s0);
    })();
    </script>
    <!--End of Tawk.to Script-->

    <!-- MAIN JAVASCRIPT - FULLY FUNCTIONAL -->
    <script>
    // ========================================
    // CONFIGURATION & GLOBAL VARIABLES
    // ========================================
    
    const CONFIG = {
        GOOGLE_SHEETS_URL: 'https://script.google.com/macros/s/AKfycbxOLElujQcy1-ZUer1KgEvK16gkTLUqYftApjNCM_IRTL3HSuDk/exec',
        WHATSAPP_NUMBER: '4916312345678', // Replace with your number
        PAYPAL_CLIENT_ID: 'YOUR_PAYPAL_CLIENT_ID',
        MAPS_API_KEY: 'YOUR_GOOGLE_MAPS_KEY',
        FIREBASE_CONFIG: {
            apiKey: "YOUR_KEY",
            authDomain: "regioconnect.firebaseapp.com",
            projectId: "regioconnect",
            storageBucket: "regioconnect.appspot.com"
        }
    };
    
    let userLocation = null;
    let currentLanguage = 'auto';
    let nearbyServices = [];
    
    // ========================================
    // INITIALIZATION
    // ========================================
    
    window.onload = function() {
        initializeApp();
        checkCookieConsent();
        detectUserLanguage();
        updateLiveStats();
        loadServicesData();
        initializePayPal();
        trackVisitor();
    };
    
    function initializeApp() {
        console.log('REGIO CONNECT initializing...');
        
        // Check URL parameters for campaigns
        const urlParams = new URLSearchParams(window.location.search);
        const source = urlParams.get('source');
        const campaign = urlParams.get('campaign');
        
        if(source) {
            trackSource(source, campaign);
        }
        
        // Show location permission after 2 seconds
        setTimeout(() => {
            if(!localStorage.getItem('locationPermission')) {
                document.getElementById('location-modal').classList.remove('hidden');
            }
        }, 2000);
    }
    
    // ========================================
    // LOCATION SERVICES
    // ========================================
    
    function acceptLocation() {
        document.getElementById('location-modal').classList.add('hidden');
        localStorage.setItem('locationPermission', 'granted');
        
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    console.log('Location detected:', userLocation);
                    updateLocationDisplay();
                    loadNearbyServices();
                },
                (error) => {
                    console.error('Location error:', error);
                    showLocationError();
                },
                {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                }
            );
        }
    }
    
    function denyLocation() {
        document.getElementById('location-modal').classList.add('hidden');
        localStorage.setItem('locationPermission', 'denied');
        loadDefaultServices();
    }
    
    function updateLocationDisplay() {
        // Reverse geocoding would go here
        const cityName = getCityFromCoords(userLocation.lat, userLocation.lng);
        document.getElementById('region-display').textContent = cityName;
        document.getElementById('current-location').textContent = 
            `${cityName} (${userLocation.lat.toFixed(4)}, ${userLocation.lng.toFixed(4)})`;
    }
    
    function getCityFromCoords(lat, lng) {
        // Simple detection for demo
        if (lat > 50.7 && lat < 51.0 && lng > 6.4 && lng < 7.0) {
            return 'Bergheim';
        } else if (lat > 50.9 && lat < 51.0 && lng > 6.9 && lng < 7.1) {
            return 'K√∂ln';
        } else if (lat > 51.1 && lat < 51.3 && lng > 6.7 && lng < 6.9) {
            return 'D√ºsseldorf';
        }
        return 'Your Location';
    }
    
    // ========================================
    // EMERGENCY FUNCTIONS
    // ========================================
    
    function showEmergency() {
        document.getElementById('emergency-modal').classList.remove('hidden');
        if(userLocation) {
            findNearestHospital();
            findNearestPharmacy();
        }
    }
    
    function closeEmergency() {
        document.getElementById('emergency-modal').classList.add('hidden');
    }
    
    function callEmergency(number) {
        window.location.href = `tel:${number}`;
    }
    
    function sendEmergencyWhatsApp() {
        const message = `üö® EMERGENCY HELP NEEDED! My location: https://maps.google.com/?q=${userLocation?.lat || 0},${userLocation?.lng || 0}`;
        window.open(`https://wa.me/${CONFIG.WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`, '_blank');
    }
    
    function findNearestHospital() {
        // In real app, this would use Google Places API
        document.getElementById('hospital-info').innerHTML = `
            <div>üìç Maria-Hilf-Krankenhaus</div>
            <div>Distance: 1.2 km</div>
            <button onclick="callEmergency('022717080')" class="text-xs underline">Call Now</button>
        `;
    }
    
    function findNearestPharmacy() {
        document.getElementById('pharmacy-info').innerHTML = `
            <div>üìç L√∂wen-Apotheke (24h)</div>
            <div>Distance: 800m</div>
            <button onclick="callEmergency('0227142117')" class="text-xs underline">Call Now</button>
        `;
    }
    
    // ========================================
    // BUSINESS REGISTRATION
    // ========================================
    
    function showRegisterModal() {
        document.getElementById('register-modal').classList.remove('hidden');
        gtag('event', 'registration_start', {
            'event_category': 'engagement'
        });
    }
    
    function closeRegisterModal() {
        document.getElementById('register-modal').classList.add('hidden');
    }
    
    async function submitRegistration(event) {
        event.preventDefault();
        
        const formData = {
            name: document.getElementById('reg-name').value,
            contact: document.getElementById('reg-contact').value,
            email: document.getElementById('reg-email').value,
            phone: document.getElementById('reg-phone').value,
            type: document.getElementById('reg-type').value,
            city: document.getElementById('reg-city').value,
            address: document.getElementById('reg-address').value,
            package: document.querySelector('input[name="package"]:checked').value,
            timestamp: new Date().toISOString(),
            source: 'website',
            location: userLocation
        };
        
        console.log('Submitting registration:', formData);
        
        // Show loading
        event.target.innerHTML = '<div class="text-center py-8"><div class="loading-spinner mx-auto"></div><p class="mt-4">Processing registration...</p></div>';
        
        try {
            // Send to Google Sheets
            const response = await fetch(CONFIG.GOOGLE_SHEETS_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });
            
            // Show success
            document.getElementById('registration-form').classList.add('hidden');
            document.getElementById('registration-success').classList.remove('hidden');
            
            // Generate payment instructions
            generatePaymentInstructions(formData);
            
            // Send WhatsApp notification to admin
            sendAdminNotification(formData);
            
            // Track conversion
            gtag('event', 'registration_complete', {
                'event_category': 'conversion',
                'value': formData.package === 'professional' ? 250 : formData.package === 'enterprise' ? 500 : 100
            });
            
            // Send welcome email (via webhook)
            sendWelcomeEmail(formData);
            
        } catch (error) {
            console.error('Registration error:', error);
            alert('Registration failed. Please try again or contact support.');
        }
    }
    
    function generatePaymentInstructions(formData) {
        const instructions = document.getElementById('payment-instructions');
        
        if(formData.package === 'professional') {
            instructions.innerHTML = `
                <h4 class="font-bold mb-2">üéâ Congratulations! Your first month is FREE!</h4>
                <p>We'll contact you before the trial ends to set up payment.</p>
            `;
        } else {
            const price = formData.package === 'enterprise' ? '500' : '100';
            instructions.innerHTML = `
                <h4 class="font-bold mb-2">Payment Instructions:</h4>
                <p>Amount: ‚Ç¨${price}/month</p>
                <div class="mt-4">
                    <button onclick="payWithPayPal('${price}')" class="bg-blue-600 text-white px-6 py-3 rounded">
                        Pay with PayPal
                    </button>
                    <button onclick="payWithTransfer('${price}')" class="bg-gray-600 text-white px-6 py-3 rounded ml-2">
                        Bank Transfer
                    </button>
                </div>
            `;
        }
    }
    
    function sendAdminNotification(formData) {
        const message = `
New Registration! üéâ
Name: ${formData.name}
Contact: ${formData.contact}
Email: ${formData.email}
Phone: ${formData.phone}
Type: ${formData.type}
Package: ${formData.package}
City: ${formData.city}
        `;
        
        window.open(`https://wa.me/${CONFIG.WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`, '_blank');
    }
    
    // ========================================
    // SEARCH FUNCTIONALITY
    // ========================================
    
    function performSearch() {
        const query = document.getElementById('global-search').value;
        if(!query) return;
        
        console.log('Searching for:', query);
        
        // Show loading
        document.getElementById('services-loading').classList.remove('hidden');
        document.getElementById('services-grid').classList.add('hidden');
        
        // Simulate search (in real app, this would query database)
        setTimeout(() => {
            const results = searchServices(query);
            displaySearchResults(results);
        }, 1000);
        
        // Track search
        gtag('event', 'search', {
            'search_term': query
        });
    }
    
    function searchServices(query) {
        // Demo data
        const allServices = [
            {name: 'Pizza Roma', type: 'Restaurant', rating: 4.5, open: true, phone: '022711234'},
            {name: 'Burger King', type: 'Restaurant', rating: 4.0, open: true, phone: '022715678'},
            {name: 'Dr. Schmidt', type: 'Doctor', rating: 4.8, open: false, phone: '022719012'},
            {name: 'Handwerker Meyer', type: 'Handwerker', rating: 4.9, open: true, phone: '022713456'}
        ];
        
        return allServices.filter(s => 
            s.name.toLowerCase().includes(query.toLowerCase()) ||
            s.type.toLowerCase().includes(query.toLowerCase())
        );
    }
    
    function displaySearchResults(results) {
        document.getElementById('services-loading').classList.add('hidden');
        
        if(results.length === 0) {
            document.getElementById('no-services').classList.remove('hidden');
            return;
        }
        
        const grid = document.getElementById('services-grid');
        grid.classList.remove('hidden');
        
        grid.innerHTML = results.map(service => `
            <div class="glass-card p-6 rounded-lg">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h3 class="text-xl font-bold">${service.name}</h3>
                        <p class="text-gray-600">${service.type}</p>
                    </div>
                    ${service.open ? 
                        '<span class="bg-green-500 text-white px-2 py-1 rounded text-xs">OPEN</span>' : 
                        '<span class="bg-gray-500 text-white px-2 py-1 rounded text-xs">CLOSED</span>'
                    }
                </div>
                <div class="flex items-center mb-4">
                    <div class="text-yellow-400">${'‚≠ê'.repeat(Math.floor(service.rating))}</div>
                    <span class="ml-2 text-sm">${service.rating} (${Math.floor(Math.random() * 100 + 50)} reviews)</span>
                </div>
                <div class="flex space-x-2">
                    <button onclick="callBusiness('${service.phone}')" class="bg-green-500 text-white px-4 py-2 rounded flex-1">
                        üìû Call
                    </button>
                    <button onclick="contactViaWhatsApp('${service.name}')" class="bg-blue-500 text-white px-4 py-2 rounded flex-1">
                        üí¨ WhatsApp
                    </button>
                </div>
            </div>
        `).join('');
    }
    
    // ========================================
    // UTILITY FUNCTIONS
    // ========================================
    
    function callBusiness(phone) {
        window.location.href = `tel:${phone}`;
    }
    
    function contactViaWhatsApp(businessName) {
        const message = businessName ? 
            `Hi! I found ${businessName} on REGIO CONNECT and would like to inquire about your services.` :
            `Hi! I'm interested in joining REGIO CONNECT. Please send me more information.`;
        
        window.open(`https://wa.me/${CONFIG.WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`, '_blank');
    }
    
    function updateLiveStats() {
        // Simulate live user count
        setInterval(() => {
            const currentCount = parseInt(document.getElementById('user-count-live').textContent);
            const change = Math.floor(Math.random() * 5) - 2; // -2 to +2
            const newCount = Math.max(1, currentCount + change);
            document.getElementById('user-count-live').textContent = newCount;
            
            // Update response time
            document.getElementById('response-time').textContent = 
                Math.floor(Math.random() * 20 + 10) + 'ms';
        }, 5000);
    }
    
    function loadServicesData() {
        // In real app, this would load from database
        setTimeout(() => {
            document.getElementById('services-loading').classList.add('hidden');
            
            // Show demo services
            const demoServices = [
                {name: 'Restaurant Bella Vista', type: 'Restaurant', open: true},
                {name: 'Handwerker Schmidt', type: 'Service', open: true},
                {name: 'Dr. Meyer', type: 'Medical', open: false}
            ];
            
            displaySearchResults(demoServices);
        }, 2000);
    }
    
    function detectUserLanguage() {
        const userLang = navigator.language || navigator.userLanguage;
        currentLanguage = userLang.substring(0, 2);
        
        // Apply translations if not German
        if(currentLanguage !== 'de') {
            translatePage(currentLanguage);
        }
    }
    
    function changeLanguage() {
        const selected = document.getElementById('language').value;
        if(selected !== 'auto') {
            currentLanguage = selected;
            translatePage(selected);
        }
    }
    
    function translatePage(lang) {
        // Basic translation system
        const translations = {
            en: {
                emergency: 'üö® EMERGENCY',
                searchPlaceholder: 'Search: Restaurant, Doctor, Plumber...',
                registerNow: 'Register Now'
            },
            de: {
                emergency: 'üö® NOTFALL',
                searchPlaceholder: 'Suche: Restaurant, Arzt, Handwerker...',
                registerNow: 'Jetzt registrieren'
            }
        };
        
        const trans = translations[lang] || translations['en'];
        
        document.querySelector('.emergency-text').textContent = trans.emergency;
        document.getElementById('global-search').placeholder = trans.searchPlaceholder;
    }
    
    // ========================================
    // COOKIE MANAGEMENT
    // ========================================
    
    function checkCookieConsent() {
        if(!localStorage.getItem('cookieConsent')) {
            document.getElementById('cookieBanner').style.display = 'block';
        } else {
            document.getElementById('cookieBanner').style.display = 'none';
        }
    }
    
    function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieBanner').style.display = 'none';
        
        // Initialize analytics
        gtag('consent', 'update', {
            'analytics_storage': 'granted'
        });
    }
    
    function rejectCookies() {
        localStorage.setItem('cookieConsent', 'rejected');
        document.getElementById('cookieBanner').style.display = 'none';
        
        // Disable analytics
        gtag('consent', 'update', {
            'analytics_storage': 'denied'
        });
    }
    
    // ========================================
    // TRACKING & ANALYTICS
    // ========================================
    
    function trackVisitor() {
        // Track page view
        gtag('event', 'page_view', {
            'page_location': window.location.href,
            'page_referrer': document.referrer
        });
        
        // Track visitor source
        const source = document.referrer || 'direct';
        console.log('Visitor from:', source);
    }
    
    function trackSource(source, campaign) {
        console.log('Traffic source:', source, 'Campaign:', campaign);
        
        // Store for attribution
        sessionStorage.setItem('trafficSource', source);
        sessionStorage.setItem('campaign', campaign || 'none');
        
        // Track in analytics
        gtag('event', 'campaign_arrival', {
            'campaign_source': source,
            'campaign_name': campaign
        });
    }
    
    // ========================================
    // PAYMENT INTEGRATION
    // ========================================
    
    function initializePayPal() {
        // PayPal button initialization would go here
        console.log('PayPal initialized');
    }
    
    function payWithPayPal(amount) {
        // In real app, this would create PayPal payment
        alert(`PayPal payment for ‚Ç¨${amount} would be processed here.`);
    }
    
    function payWithTransfer(amount) {
        alert(`Bank Transfer Details:\nIBAN: DE89 3704 0044 0532 0130 00\nAmount: ‚Ç¨${amount}\nReference: Your email address`);
    }
    
    // ========================================
    // QUICK ACTION FUNCTIONS
    // ========================================
    
    function findOpenNow() {
        const hour = new Date().getHours();
        if(hour < 8 || hour > 20) {
            alert('Showing only 24/7 services at this hour.');
        }
        document.getElementById('global-search').value = '24/7';
        performSearch();
    }
    
    function showFoodOptions() {
        document.getElementById('global-search').value = 'Restaurant';
        performSearch();
    }
    
    function showEmergencyServices() {
        showEmergency();
    }
    
    function showTransport() {
        document.getElementById('global-search').value = 'Taxi';
        performSearch();
    }
    
    function showBusinessLogin() {
        alert('Business Dashboard coming soon! For now, please register first.');
        showRegisterModal();
    }
    
    function openSupport() {
        // Open live chat
        if(window.Tawk_API) {
            window.Tawk_API.maximize();
        }
    }
    
    function openFAQ() {
        window.open('https://dacho3008.github.io/dacho3008.githup.io/faq', '_blank');
    }
    
    function showPricing() {
        document.getElementById('pricing-section')?.scrollIntoView({behavior: 'smooth'});
    }
    
    function showContact() {
        contactViaWhatsApp();
    }
    
    // ========================================
    // FORM VALIDATION
    // ========================================
    
    document.getElementById('reg-phone')?.addEventListener('input', function(e) {
        // Format phone number
        let value = e.target.value.replace(/\D/g, '');
        if(value.length > 0) {
            if(value.length <= 4) {
                value = value;
            } else if(value.length <= 8) {
                value = value.slice(0, 4) + ' ' + value.slice(4);
            } else {
                value = value.slice(0, 4) + ' ' + value.slice(4, 8) + ' ' + value.slice(8, 13);
            }
        }
        e.target.value = value;
    });
    
    // ========================================
    // ERROR HANDLING
    // ========================================
    
    window.addEventListener('error', function(e) {
        console.error('Application error:', e.error);
        // In production, send to error tracking service
    });
    
    function showLocationError() {
        console.error('Could not get user location');
        // Load default services for Bergheim
        loadDefaultServices();
    }
    
    function loadDefaultServices() {
        // Load Bergheim as default
        document.getElementById('region-display').textContent = 'Bergheim';
        loadServicesData();
    }
    
    function sendWelcomeEmail(formData) {
        // This would trigger an email via backend service
        console.log('Welcome email would be sent to:', formData.email);
    }
    
    console.log('REGIO CONNECT v2.0 - Fully Functional');
    </script>
</body>
</html>
